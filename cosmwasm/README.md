# Catalyst CosmWasm Implementation

# Create new contract
Inside the contracts folder, run:
```
cargo generate --git https://github.com/CosmWasm/cw-template.git --name PROJECT_NAME -d minimal=true 
```

# Structure

## Assets
- `VaultAssetsTrait`
- `AssetTrait`

### Native Assets

### CW20 Assets

## Vault Tokens

### Native Tokens

### CW20 Tokens

## Types

`CosmosMsg<T>` is generic on some type `T`. This generic defines the type `CosmosMsg::Custom(T)`.
It is desired to have the *asset* and *vault-tokens* modules to be completely independent of the core vault logic. These modules may generate messages to be included within the vault transactions (e.g. to order the bank to execute a transfer). For future proofing, it cannot be assumed what the type of these messages is, e.g. to use the `TokenFactory` module, messages of the type `CosmosMsg::Custom(TokenFactoryMsg::Token(msg))` have to be used. Problem: what if it is desired to have **another** type of message within `CosmosMsg::Custom` that is **not** of the type `TokenFactoryMsg` (`TokenFactoryMsg` is defined on an external library). There are two possible solutions:
1. Define in a common location a custom type that defines the generic type `T` to be used by **all** the vaults and **all** the modules (*asset* and *vault-tokens*): e.g. an enum that would merge the values from `TokenFactoryMsg` and all other desired enums. To avoid increasing the number of interconnected dependencies, this is not deemed an optimal solution.
2. Introduce a method to be able to cast the msg types generated by the *asset* and *vault-tokens* modules into the correct `CosmosMsg<T>` depending on the desired vaults configuration. This is the implemented approach.
    - A new enum `VaultMsg` is used to define the possible values of the `CosmosMsg::Custom(T)` message. This means the vaults are defined to use `CosmosMsg<VaultMsg>`.
    - The enum `VaultMsg` can be selected between different possible values or built at compile time according to the selected compilation features.
    - The modules *asset* and *vault-tokens* (and any future modules) generate their messages with any type they wish, but do not return the completely formed `CosmosMsg` (e.g. return `BankMsg::Send {...}` instead of `CosmosMsg::Bank(BankMsg::Send {...})`).
    - A new trait `IntoCosmosVaultMsg` defines a common interface to cast any message that implements it into a `CosmosMsg`. This trait is used by the vaults to cast any message generated by the external modules (i.e. currently the *asset* and *vault-tokens*) into a `CosmosMsg` that can be directly used by the vault. This trait is implemented **by the vault module itself**, as it is the vault code which defines the `VaultMsg` type. Note that the standard traits `From/Into` cannot be used, as the source type and the target type are both external to the common vault code.

# Testing

## Custom Test Environment
- `CustomTestEnvironment`
- `CustomTestAsset`

### Native Assets

### CW20 Assets